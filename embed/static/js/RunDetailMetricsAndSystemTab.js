(this.webpackJsonpui_v2=this.webpackJsonpui_v2||[]).push([[8],{1530:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n(56),c=n(260),r=n(354),o=n(261),s=n(6),l=n(3),u=n(13),d=n(11),f=n(817),m=n(253),b=n(47),x=n(101),g=n(247),v=n(49),h=n(330),R=n(732),j=n(24),O=n(81),p=n(1);function y(e){var t;let{batch:n,index:i,observer:c,isPinned:r,togglePin:o}=e;const u=a.useRef(null);return a.useEffect((()=>{u.current&&c&&c.observe(u.current)}),[c]),Object(p.jsx)(s.a,{children:Object(p.jsxs)("div",{className:"RunDetailMetricsTab__container__chartContainer","data-name":n.name,"data-context":Object(x.a)(n.context),ref:u,children:[Object(p.jsx)(h.a,{title:r?"Unpin":"Pin",children:Object(p.jsx)("div",{className:"RunDetailMetricsTab__container__chartContainer__metricDetailBox__pin",children:Object(p.jsx)(l.c,{color:r?"primary":"default",size:"xSmall",variant:"outlined",withOnlyIcon:!0,onClick:()=>o({name:n.name,context:n.context},r),children:Object(p.jsx)(l.f,{name:"pin"})})})}),Object(p.jsx)("div",{className:"RunDetailMetricsTab__container__chartContainer__chartBox",children:n.iters?Object(p.jsx)(s.a,{children:Object(p.jsx)(R.a,{data:[{key:n.key,data:{xValues:[...n.iters],yValues:[...n.values]},color:"#1c2852",dasharray:"none",selectors:[n.key]}],index:i})}):Object(p.jsx)(l.l,{})}),Object(p.jsxs)("div",{className:"RunDetailMetricsTab__container__chartContainer__metricDetailBox",children:[Object(p.jsx)(l.n,{component:"h4",tint:100,size:18,weight:600,className:"RunDetailMetricsTab__container__chartContainer__metricDetailBox__metricName",children:Object(b.a)(null===n||void 0===n?void 0:n.name)?Object(O.a)(null===n||void 0===n?void 0:n.name):null===n||void 0===n?void 0:n.name}),null===(t=Object(x.a)(null===n||void 0===n?void 0:n.context))||void 0===t?void 0:t.split(",").map(((e,t)=>Object(p.jsx)(l.b,{monospace:!0,size:"large",color:j.c[0][(t+i)%j.c[0].length],label:e||"Empty context"},t)))]})]})})}var _=a.memo(y);function S(e){let{runHash:t,runTraces:n,runBatch:h,isSystem:R,isRunBatchLoading:j}=e;const O=a.useRef(null),y=a.useRef(),[S,N]=a.useState(!1),[C,A]=a.useState([]),D=Object(c.a)(m.a,!1),T=a.useMemo((()=>n.metric.filter((e=>R?Object(b.a)(e.name):!Object(b.a)(e.name)))),[n.metric,R]);let w=[],M=[];for(let a=0;a<T.length;a++){var B,L;let e=T[a],t=null!==(B=null===D||void 0===D||null===(L=D.pinnedSequences)||void 0===L?void 0:L.findIndex((t=>t.name===e.name&&Object(x.a)(t.context)===Object(x.a)(e.context))))&&void 0!==B?B:-1;t>-1?w[t]=e:M.push(e)}async function z(e,t){const n=t?w.filter((t=>!(t.name===e.name&&Object(x.a)(t.context)===Object(x.a)(e.context)))):[...w,e],a=m.a.setPinnedSequences({sequences:n},(e=>{m.a.setState({pinnedSequences:w}),Object(v.a)({detail:e,model:f.a})}));m.a.setState({pinnedSequences:n}),a.call()}function E(e,t){return S&&e.length>0&&Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{className:"RunDetailMetricsTab__header",children:Object(p.jsxs)(l.n,{component:"h3",size:16,color:"primary",children:[t?"Pinned ":"","Metrics"]})}),Object(p.jsx)("div",{className:"RunDetailMetricsTab__container",children:(t?e:e.map((e=>({...e,sortKey:"".concat(e.name,"_").concat(Object(x.a)(e.context))}))).sort(Object(g.a)({orderBy:"sortKey"}))).map(((e,n)=>{const a={...e,...null===h||void 0===h?void 0:h.find((t=>t.name===e.name&&Object(x.a)(t.context)===Object(x.a)(e.context)))};return Object(p.jsx)(_,{batch:a,index:n,observer:y.current,isPinned:t,togglePin:z},"".concat(a.name,"_").concat(Object(x.a)(a.context)))}))})]})}return w.filter((e=>!!e)),a.useEffect((()=>{if(O.current){var e;let t={root:null===(e=O.current.parentElement)||void 0===e?void 0:e.parentElement,rootMargin:"0px",threshold:0};y.current=new IntersectionObserver((e=>{let t=[];e.forEach((e=>{if(e.isIntersecting){let n=e.target.getAttribute("data-name"),a=e.target.getAttribute("data-context");(null===h||void 0===h?void 0:h.find((e=>e.name===n&&Object(x.a)(e.context)===a)))||t.push({name:n,context:a})}})),t.length>0&&A((e=>e.concat(t.map((e=>T.find((t=>t.name===e.name&&Object(x.a)(t.context)===e.context)))))))}),t),N(!0)}return d.a(u.a.runDetails.tabs[R?"system":"metrics"].tabView),()=>{y.current&&y.current.disconnect()}}),[R,h,S,n.metric,T]),a.useEffect((()=>{let e,n;return C.length>0&&(e=window.setTimeout((()=>{n=f.a.getRunMetricsBatch(C,t),n.call()}),100)),()=>{e&&clearTimeout(e),n&&n.abort()}}),[C,t]),a.useEffect((()=>{A((e=>e.filter((e=>-1===h.findIndex((t=>t.name===e.name&&Object(x.a)(t.context)===Object(x.a)(e.context)))))))}),[h]),Object(p.jsx)(s.a,{children:Object(p.jsx)(o.a,{isLoading:j,className:"RunDetailTabLoader",height:"100%",children:i.a.isEmpty(T)?Object(p.jsx)(r.a,{size:"xLarge",className:"RunDetailTabLoader",title:"No tracked ".concat(R?"system":""," metrics")}):Object(p.jsxs)("div",{className:"RunDetailMetricsTab",ref:O,children:[E(w,!0),E(M,!1)]})})})}t.default=a.memo(S)},709:function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return s}));const a=100,i={S:4,M:6,L:12},{S:c,M:r,L:o}=i,s={1:[o],2:[r,r],3:[c,c,c],4:[r,r,r,r],5:[c,c,c,r,r],6:[c,c,c,c,c,c],7:[c,c,c,r,r,r,r],8:[c,c,c,c,c,c,r,r],9:[c,c,c,c,c,c,c,c,c]}},732:function(e,t,n){"use strict";var a=n(0),i=n(10),c=n.n(i),r=n(260),o=n(6),s=n(709),l=n(9),u=(n(733),n(1));const d=a.forwardRef((function(e,t){const{data:n,index:i,id:d="".concat(i),nameKey:f="",aggregatedData:m,aggregationConfig:b,syncHoverState:x,axesScaleRange:g,ignoreOutliers:v=!1,alignmentConfig:h,highlightMode:R=l.e.Off,curveInterpolation:j=l.d.Linear,chartTitle:O,zoom:p,onZoomChange:y,resizeMode:_,onMount:S,axesScaleType:N={xAxis:l.h.Linear,yAxis:l.h.Linear},readOnly:C=!1,margin:A={top:30,right:20,bottom:30,left:60}}=e,D=a.useRef({margin:A,height:0,width:0}),T=a.useRef({height:0,width:0}),w=a.useRef(null),M=a.useRef(null),B=a.useRef(null),L=a.useRef(null),z=a.useRef(null),E=a.useRef(null),k=a.useRef(null),I=a.useRef(null),H=a.useRef(null),q=a.useRef(null),P=a.useRef(null),F=a.useRef({}),K=a.useRef({}),V=a.useRef({}),J=a.useRef({}),Z=a.useRef(),U=[],X=[n,p,v,R,N,g,j,b,C,h,_,d];function G(){Object(l.k)({visAreaRef:M}),function(){Object(l.l)({index:i,id:d,nameKey:f,visBoxRef:D,plotBoxRef:T,parentRef:w,visAreaRef:M,svgNodeRef:B,bgRectNodeRef:L,plotNodeRef:z,axesNodeRef:E,linesNodeRef:k,attributesNodeRef:I,chartTitle:O});const{processedData:e,processedAggrData:t,min:a,max:c}=Object(l.C)({data:n,ignoreOutliers:v,visBoxRef:D,axesScaleType:N,axesScaleRange:g,aggregatedData:m,aggregationConfig:b,unableToDrawConditions:U,attributesRef:V});Object(l.m)({svgNodeRef:B,axesNodeRef:E,axesRef:F,plotBoxRef:T,xScale:V.current.xScale,yScale:V.current.yScale,visBoxRef:D,alignmentConfig:h,axesScaleType:N,humanizerConfigRef:J,drawBgTickLines:{y:!0,x:!1}}),Object(l.q)({id:d,processedData:e,nameKey:f,linesNodeRef:k,linesRef:K,curveInterpolation:j,xScale:V.current.xScale,yScale:V.current.yScale,highlightMode:R,aggregationConfig:b,processedAggrData:t,readOnly:C}),!C&&k.current&&k.current.selectChildren().size()>s.c&&k.current.classed("optimizeRendering",!0);Object(l.n)({id:d,plotBoxRef:T,plotNodeRef:z,visBoxRef:D,axesRef:F,attributesRef:V,linesRef:K,svgNodeRef:B,axesScaleType:N,min:a,max:c,axesScaleRange:g,zoom:p,onZoomChange:y,readOnly:C,unableToDrawConditions:U}),C||Object(l.o)({index:i,id:d,nameKey:f,data:n,processedData:e,axesScaleType:N,highlightMode:R,syncHoverState:x,visAreaRef:M,attributesRef:V,plotBoxRef:T,visBoxRef:D,svgNodeRef:B,bgRectNodeRef:L,attributesNodeRef:I,xAxisLabelNodeRef:H,yAxisLabelNodeRef:q,linesNodeRef:k,highlightedNodeRef:P,aggregationConfig:b,alignmentConfig:h}),Object(l.y)({renderArr:U,visAreaRef:M,attributesRef:V,readOnly:C,syncHoverState:x})}()}const Q=a.useCallback((e=>{(null===e||void 0===e?void 0:e.length)&&(Z.current=window.requestAnimationFrame(G))}),X),W=a.useCallback((()=>{Z.current&&window.cancelAnimationFrame(Z.current)}),[]);return Object(r.c)(Q,w,W),a.useEffect((()=>{V.current.currentXValue=void 0}),[h,n]),a.useEffect((()=>(Z.current=window.requestAnimationFrame(G),()=>{Z.current&&window.cancelAnimationFrame(Z.current)})),X),a.useEffect((()=>{"function"===typeof S&&S()}),[]),a.useImperativeHandle(t,(()=>({setActiveLineAndCircle:function(e){var t,n;let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];null===(t=(n=V.current).setActiveLineAndCircle)||void 0===t||t.call(n,e,a,i)},updateHoverAttributes:(e,t)=>{var n,a;null===(n=(a=V.current).updateHoverAttributes)||void 0===n||n.call(a,e,t)},clearHoverAttributes:()=>{var e,t;null===(e=(t=V.current).clearHoverAttributes)||void 0===e||e.call(t)},setFocusedState:e=>{var t;e&&(V.current.focusedState={...e,visId:null!==(t=e.visId)&&void 0!==t?t:"".concat(e.chartIndex)})}}))),Object(u.jsx)(o.a,{children:Object(u.jsx)("div",{id:"vis-"+d,ref:w,className:c()("LineChart",{zoomMode:!C&&(null===p||void 0===p?void 0:p.active)}),children:Object(u.jsx)("div",{ref:M})})})}));d.displayName="LineChart",t.a=a.memo(d)},733:function(e,t,n){}}]);